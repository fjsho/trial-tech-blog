# 実装タスク: ガジェットカテゴリーフィルタリング機能

## 概要

本タスクリストは、ガジェットページにおけるカテゴリーフィルタリング機能を、再利用可能な`CategoryFilter.astro`コンポーネントとしてリファクタリングする実装計画です。既存の機能を保持しつつ、レイアウト一貫性と将来の拡張性を確保します。

---

## 実装タスク

- [x] 1. CategoryFilter.astroコンポーネントの作成
- [x] 1.1 コンポーネントの基本構造とPropsインターフェースを実装
  - カテゴリーリスト、ターゲットセレクタ、初期アクティブカテゴリーを受け取るPropsを定義
  - 「すべて」ボタンを含む全カテゴリーボタンをレンダリング
  - 各ボタンにdata-category属性を付与
  - _Requirements: 1.1, 1.2, 1.3, 5.2_

- [x] 1.2 フィルタリングロジックのクライアントサイドスクリプトを実装
  - ボタンクリックイベントリスナーを登録
  - アクティブ状態の管理（activeクラスの追加/削除）
  - ターゲット要素のdata-category属性を比較してフィルタリング実行
  - display: flex/noneによる表示/非表示制御
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 5.3, 5.4_

- [x] 1.3 フィルターUIのスタイリングを実装
  - filters-containerとfiltersのレイアウトスタイル（max-width, padding, flexbox）
  - filter-btnの非アクティブ/アクティブ/ホバー状態のスタイル
  - ガジェットテーマカラー (#7dc2bb) の適用
  - 角丸、トランジション、text-transform: capitalizeの設定
  - _Requirements: 1.5, 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 1.4 レスポンシブデザインの実装
  - 768px以下のメディアクエリでフォントサイズとパディングを調整
  - モバイルビューでボタンの中央揃えとタップしやすいサイズを維持
  - 複数行折り返し時のギャップを一貫して保持
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 2. gadget.astroページのリファクタリング
- [x] 2.1 CategoryFilterコンポーネントをインポートして配置
  - CategoryFilter.astroをインポート
  - Heroセクションの直後にCategoryFilterを配置
  - categories配列とtargetSelector=".gadget-card"をPropsとして渡す
  - _Requirements: 1.4_

- [x] 2.2 既存のフィルター関連コードを削除
  - Section内の`<div class="filters">`セクションを削除
  - フィルタリング用の`<script>`タグを削除
  - `.filters`と`.filter-btn`のCSSスタイルを削除
  - _Requirements: 既存実装からの移行_

- [x] 2.3 ガジェットグリッドの配置を確認
  - ガジェットグリッドがSectionコンポーネント内に正しく配置されているか確認
  - EmptyState表示の条件分岐が正しく動作するか確認
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 3. ブラウザでの動作確認と検証
- [x] 3.1 基本的なフィルタリング機能の動作確認
  - 開発サーバーを起動してガジェットページにアクセス
  - 「すべて」ボタンが初期アクティブ状態で全カードが表示されることを確認
  - 各カテゴリーボタンをクリックして該当カードのみ表示されることを確認
  - ボタンのアクティブ状態が正しく切り替わることを確認
  - _Requirements: 1.1, 1.3, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 3.2 ビジュアルデザインとレスポンシブの検証
  - フィルターボタンの非アクティブ/アクティブ/ホバー状態のスタイルを確認
  - ガジェットテーマカラー、角丸、トランジション効果を確認
  - ビューポートを768px以下に縮小してモバイルビューのスタイルを確認
  - ボタンの折り返しとギャップが適切か確認
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4_

- [x] 3.3 レイアウト一貫性の確認
  - ブログページ (/blog) のコンテンツグリッド開始位置を測定 (356.98px)
  - ガジェットページ (/gadget) のコンテンツグリッド開始位置を測定 (463.98px)
  - 書籍ページ (/book) のコンテンツグリッド開始位置を測定 (356.98px)
  - 注: ガジェットページは要件1.4に従いフィルターUIを配置したため、他ページと107px差異あり（既知の問題1として文書化済み）
  - _Requirements: 1.4（レイアウト一貫性の目標）_

- [x] 3.4 エラーハンドリングと空状態の確認
  - ブラウザのDevToolsコンソールでJavaScriptエラーがないか確認
  - ガジェット0件の場合にEmptyStateが表示されフィルターUIが非表示になることを確認
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 4. ビルドと最終検証
- [x] 4.1 プロダクションビルドの実行と検証
  - `npm run build` を実行してビルドエラーがないか確認
  - ビルドされた静的ファイルを `npm run preview` でプレビュー
  - プレビューサーバーで全ての機能が正常に動作することを確認
  - _Requirements: 全要件の統合確認_

- [x] 4.2 パフォーマンスの確認
  - ブラウザDevToolsのPerformance Panelでフィルタリング応答速度を測定（目標: 100ms以内）
  - リフロー回数が最小限（単一リフロー）であることを確認
  - _Requirements: パフォーマンス要件_

---

## 実装順序の理由

1. **CategoryFilter.astroコンポーネントの作成（タスク1）**: 再利用可能なコンポーネントとして完全に独立させることで、gadget.astroとの統合が容易になります。
2. **gadget.astroのリファクタリング（タスク2）**: コンポーネントが完成した後、既存実装を新しいコンポーネントに置き換えます。
3. **動作確認と検証（タスク3）**: 機能、ビジュアル、レイアウト一貫性を段階的に確認します。
4. **ビルドと最終検証（タスク4）**: プロダクション環境での動作とパフォーマンスを確認します。

---

## 注意事項

- **既存の機能を壊さない**: ガジェットカードの`data-category`属性は維持し、既存のContent Collections連携は変更しません。
- **レイアウト一貫性**: CategoryFilterをSectionの外に配置することで、ブログ・書籍ページとコンテンツグリッドの垂直位置を揃えます。
- **再利用性**: 将来的にBookやBlogページでも同じCategoryFilterコンポーネントを使用できるよう、targetSelectorでジェネリックに設計します。
- **段階的な検証**: 各タスク完了後に開発サーバーで動作確認を行い、問題を早期発見します。
