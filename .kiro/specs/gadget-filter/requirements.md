# Requirements Document

## Introduction

本要件定義書は、ガジェットページにおけるカテゴリー別フィルタリング機能の既存実装を文書化したものです。この機能により、サイト訪問者は興味のあるカテゴリーのガジェットを素早く絞り込んで閲覧できます。

### ビジネス価値
- **ユーザビリティ向上**: 訪問者が目的のガジェットを素早く見つけられる
- **コンテンツ探索の促進**: カテゴリー別の整理により、関連製品の発見を促す
- **エンゲージメント向上**: 興味のあるカテゴリーに集中できることで、サイト滞在時間が向上

### スコープ
- ガジェットページ (`/gadget`) におけるカテゴリーフィルタリング機能
- クライアントサイドでの動的なフィルタリング
- レスポンシブデザイン対応

---

## Requirements

### Requirement 1: カテゴリーフィルターUIの表示

**Objective:** サイト訪問者として、ガジェットをカテゴリー別にフィルタリングできるように、視覚的に分かりやすいフィルターボタンを表示したい。

#### Acceptance Criteria

1. WHEN ガジェットページが読み込まれる THEN ガジェットフィルターシステム SHALL 全てのカテゴリー（「すべて」を含む）をボタンとして表示する
2. WHERE ガジェットが1件以上存在する THE ガジェットフィルターシステム SHALL ガジェットデータから一意のカテゴリーリストを自動抽出する
3. WHEN フィルターボタンが表示される THEN ガジェットフィルターシステム SHALL 「すべて」ボタンをアクティブ状態として初期表示する
4. WHERE フィルターUIが配置される THE ガジェットフィルターシステム SHALL ヒーローセクションとガジェットグリッドの間にフィルターUIを配置する
5. WHEN 複数のカテゴリーボタンが存在する THEN ガジェットフィルターシステム SHALL ボタンを水平方向にflexboxレイアウトで配置し、必要に応じて複数行に折り返す

---

### Requirement 2: カテゴリーフィルターのインタラクション

**Objective:** サイト訪問者として、フィルターボタンをクリックすることで、選択したカテゴリーのガジェットのみを即座に表示したい。

#### Acceptance Criteria

1. WHEN ユーザーがフィルターボタンをクリックする THEN ガジェットフィルターシステム SHALL クリックされたボタンをアクティブ状態にする
2. WHEN 新しいフィルターボタンがアクティブになる THEN ガジェットフィルターシステム SHALL 以前アクティブだったボタンを非アクティブ状態にする
3. WHEN 「すべて」ボタンがクリックされる THEN ガジェットフィルターシステム SHALL 全てのガジェットカードを表示状態にする
4. WHEN 特定のカテゴリーボタンがクリックされる THEN ガジェットフィルターシステム SHALL 選択されたカテゴリーに一致するガジェットカードのみを表示する
5. WHEN 選択されたカテゴリーに一致しないガジェットカードが存在する THEN ガジェットフィルターシステム SHALL それらのカードを非表示にする
6. WHEN フィルタリングが実行される THEN ガジェットフィルターシステム SHALL ページリロードなしにクライアントサイドで即座に表示を更新する

---

### Requirement 3: フィルターボタンのビジュアルデザイン

**Objective:** サイト訪問者として、現在選択されているカテゴリーを視覚的に明確に把握できるように、デザインされたフィルターボタンを使用したい。

#### Acceptance Criteria

1. WHERE フィルターボタンが非アクティブ状態である THE ガジェットフィルターシステム SHALL 白背景にガジェットテーマカラー (#7dc2bb) のボーダーとテキストで表示する
2. WHERE フィルターボタンがアクティブ状態である THE ガジェットフィルターシステム SHALL ガジェットテーマカラー (#7dc2bb) の背景に白テキストで表示する
3. WHEN ユーザーがフィルターボタンにホバーする THEN ガジェットフィルターシステム SHALL ガジェットテーマカラーの半透明背景 (rgba(125, 194, 187, 0.1)) を表示する
4. WHERE フィルターボタンのスタイルが適用される THE ガジェットフィルターシステム SHALL 角丸 (8px)、適切なパディング、および0.2秒のトランジション効果を適用する
5. WHEN カテゴリー名が英語である THEN ガジェットフィルターシステム SHALL テキストを capitalize 形式で表示する

---

### Requirement 4: レスポンシブデザイン対応

**Objective:** サイト訪問者として、モバイルデバイスやタブレットでも快適にフィルター機能を使用できるように、画面サイズに応じた適切なレイアウトで表示したい。

#### Acceptance Criteria

1. WHERE 画面幅が768px以下である THE ガジェットフィルターシステム SHALL フィルターボタンのフォントサイズを0.875remに縮小する
2. WHERE 画面幅が768px以下である THE ガジェットフィルターシステム SHALL フィルターボタンのパディングを0.5rem 1remに調整する
3. WHEN フィルターボタンが複数行に折り返される THEN ガジェットフィルターシステム SHALL ボタン間に一貫した0.75remのギャップを保持する
4. WHERE フィルターUIが狭い画面で表示される THE ガジェットフィルターシステム SHALL ボタンを中央揃えで配置し、タップしやすいサイズを維持する

---

### Requirement 5: データ属性による連携

**Objective:** 開発者として、フィルタリングロジックを実装するために、ガジェットカードとフィルターボタンに適切なdata属性を付与したい。

#### Acceptance Criteria

1. WHERE ガジェットカードがレンダリングされる THE ガジェットフィルターシステム SHALL 各カードに `data-category` 属性としてカテゴリー値を設定する
2. WHERE フィルターボタンがレンダリングされる THE ガジェットフィルターシステム SHALL 各ボタンに `data-category` 属性としてカテゴリー値を設定する
3. WHEN フィルタリングロジックが実行される THEN ガジェットフィルターシステム SHALL ボタンの `data-category` 値とカードの `data-category` 値を比較してフィルタリングを行う
4. WHERE JavaScriptが実行される THE ガジェットフィルターシステム SHALL `.filter-btn` クラスと `.gadget-card` クラスを使用して要素を特定する

---

### Requirement 6: 空状態とエラーハンドリング

**Objective:** サイト訪問者として、ガジェットが登録されていない場合でも、適切なメッセージを表示することで、サイトの状態を理解したい。

#### Acceptance Criteria

1. IF ガジェットが0件である THEN ガジェットフィルターシステム SHALL 「まだガジェットが登録されていません」というメッセージを表示する
2. IF ガジェットが0件である THEN ガジェットフィルターシステム SHALL フィルターUIを表示しない
3. WHERE ガジェットが1件以上存在する THE ガジェットフィルターシステム SHALL ガジェットグリッドとフィルターUIの両方を表示する

---

## 既存実装の技術的特徴

### 実装パターン
- **カテゴリー抽出**: `Set` を使用してガジェットデータから一意のカテゴリーを動的に抽出
- **フィルタリング方式**: クライアントサイドJavaScript (`<script>` タグ) によるDOM操作
- **表示制御**: `display` プロパティ (`flex` / `none`) によるshow/hide制御
- **状態管理**: CSS クラス (`active`) による選択状態の管理

### データフロー
1. **ビルド時**: Astro Content Collectionsからガジェットデータを取得
2. **サーバーサイド**: カテゴリーリストの生成とHTML生成
3. **クライアントサイド**: イベントリスナーによるフィルタリングロジックの実行

### 技術スタック
- **フレームワーク**: Astro (静的サイト生成)
- **スタイリング**: スコープドCSS (Astro組み込み)
- **クライアントサイドロジック**: Vanilla JavaScript
- **データソース**: Astro Content Collections

---

## 既知の制限事項と改善候補

### 既知の問題
1. **UIレイアウト**: フィルターUIがSectionコンポーネント内に配置されているため、他ページとレイアウトが異なる (TODOコメントあり)
2. **URL連動なし**: フィルター状態がURLに反映されないため、直接リンクや共有ができない
3. **SEO非対応**: クライアントサイドフィルタリングのため、検索エンジンはフィルター結果をインデックスできない
4. **アクセシビリティ**: キーボードナビゲーションやARIA属性が不足している可能性

### 将来的な改善案
- フィルターUIを Section の外に配置して他ページとレイアウトを統一
- URLパラメータとの連動 (`?category=audio` など)
- ARIA属性の追加 (`aria-pressed`, `role="group"` など)
- アニメーション効果の追加 (フェードイン/アウト)
- カテゴリーカウント表示 (`audio (3)` など)
