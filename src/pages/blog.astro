---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import EmptyState from '../components/EmptyState.astro';
import BlogPost from '../components/BlogPostCard.astro';
import type { BlogPost as BlogPostType } from '../lib/types/blogPost';
import { fetchQiitaArticles } from '../lib/api/qiita';
import { fetchZennArticles } from '../lib/api/zenn';

const pageTitle = 'Blog';
const pageDescription = '学んだことや技術についてのメモや記事';

// QiitaとZennの記事情報を取得
const qiitaArticles: BlogPostType[] = await fetchQiitaArticles();
const zennArticles: BlogPostType[] = await fetchZennArticles();

// 両方の記事を合わせて、published_atの新しい順にソート
const blogPosts: BlogPostType[] = [...qiitaArticles, ...zennArticles].sort(
  (a, b) => new Date(b.published_at).getTime() - new Date(a.published_at).getTime()
);
---

<BaseLayout pageTitle={pageTitle}>
  <Hero
    title={pageTitle}
    description={pageDescription}
    variant="blog"
  />

  <Section maxWidth="900px">
    {blogPosts.length === 0 ? (
      <EmptyState message="まだ記事が投稿されていません" />
    ) : (
      <div class="posts-grid">
        {blogPosts.map((post) => (
          <BlogPost post={post} />
        ))}
      </div>
    )}
  </Section>
</BaseLayout>

<style>
  .posts-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .posts-grid {
      gap: 1.5rem;
    }
  }
</style>
