---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import EmptyState from '../components/EmptyState.astro';
import GadgetCard from '../components/GadgetCard.astro';
import { getCollection } from 'astro:content';
import type { Gadget } from '../lib/types/gadget';

const pageTitle = 'Gadget';
const pageDescription = '愛用しているガジェットやツールの紹介';

const gadgetEntries = await getCollection('gadgets');

// Sort by created_at descending
const gadgets: Gadget[] = gadgetEntries
  .map((entry: any) => entry.data)
  .sort((a: Gadget, b: Gadget) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());

const categories = ['all', ...new Set(gadgets.map(g => g.category))];
---

<BaseLayout pageTitle={pageTitle}>
  <Hero
    title={pageTitle}
    description={pageDescription}
    variant="gadget"
  />

  <Section maxWidth="1200px">
    <div class="filters" id="filters">
      {categories.map((category) => (
        <button
          class={`filter-btn ${category === 'all' ? 'active' : ''}`}
          data-category={category}
        >
          {category === 'all' ? 'すべて' : category}
        </button>
      ))}
    </div>

    {gadgets.length === 0 ? (
      <EmptyState message="まだガジェットが登録されていません" />
    ) : (
      <div class="gadgets-grid" id="gadgets-grid">
        {gadgets.map((gadget) => (
          <GadgetCard gadget={gadget} />
        ))}
      </div>
    )}
  </Section>
</BaseLayout>

<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const gadgetCards = document.querySelectorAll('.gadget-card');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');

      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      gadgetCards.forEach(card => {
        const cardCategory = card.getAttribute('data-category');
        if (category === 'all' || cardCategory === category) {
          card.style.display = 'flex';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
</script>

<style>
  .filters {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .filter-btn {
    padding: 0.5rem 1.25rem;
    background-color: white;
    border: 2px solid #7dc2bb;
    color: #7dc2bb;
    border-radius: 8px;
    font-size: 0.9375rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: capitalize;
  }

  .filter-btn:hover {
    background-color: rgba(125, 194, 187, 0.1);
  }

  .filter-btn.active {
    background-color: #7dc2bb;
    color: white;
  }

  .gadgets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .gadgets-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .filter-btn {
      font-size: 0.875rem;
      padding: 0.5rem 1rem;
    }
  }
</style>
