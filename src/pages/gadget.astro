---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import CategoryFilter from '../components/CategoryFilter.astro';
import Section from '../components/Section.astro';
import EmptyState from '../components/EmptyState.astro';
import GadgetCard from '../components/GadgetCard.astro';
import { getCollection } from 'astro:content';
import type { Gadget } from '../lib/types/gadget';

const pageTitle = 'Gadget';
const pageDescription = '愛用しているガジェットやツールの紹介';

const gadgetEntries = await getCollection('gadgets');

// Sort by created_at descending
const gadgets: Gadget[] = gadgetEntries
  .map((entry: any) => entry.data)
  .sort((a: Gadget, b: Gadget) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());

const categories = ['all', ...new Set(gadgets.map(g => g.category))];
---

<BaseLayout pageTitle={pageTitle}>
  <Hero
    title={pageTitle}
    description={pageDescription}
    variant="gadget"
  />

  <CategoryFilter categories={categories} targetSelector=".gadget-card" />

  <Section maxWidth="1200px">
    {gadgets.length === 0 ? (
      <EmptyState message="まだガジェットが登録されていません" />
    ) : (
      <div class="gadgets-grid" id="gadgets-grid">
        {gadgets.map((gadget) => (
          <GadgetCard gadget={gadget} />
        ))}
      </div>
    )}
  </Section>
</BaseLayout>

<style>
  .gadgets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .gadgets-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>
