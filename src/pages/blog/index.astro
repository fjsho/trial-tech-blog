---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Section from '../../components/Section.astro';
import EmptyState from '../../components/EmptyState.astro';
import BlogPost from '../../components/BlogPost.astro';
import { supabase, type BlogPost as BlogPostType } from '../../lib/supabase';

const { data: posts, error } = await supabase
  .from('blog_posts')
  .select('*')
  .order('published_at', { ascending: false });

const blogPosts: BlogPostType[] = posts || [];
---

<BaseLayout title="Blog - Tech Blog" description="技術メモ、スキルアップの記録、外部プラットフォーム記事">
  <Hero
    title="Blog"
    description="技術メモ、スキルアップの記録、Zenn/Qiita記事"
    variant="blog"
  />

  <Section maxWidth="900px">
    {blogPosts.length === 0 ? (
      <EmptyState message="まだ記事が投稿されていません" />
    ) : (
      <div class="posts-grid">
        {blogPosts.map((post) => (
          <BlogPost post={post} />
        ))}
      </div>
    )}
  </Section>
</BaseLayout>

<style>
  .posts-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .posts-grid {
      gap: 1.5rem;
    }
  }
</style>
