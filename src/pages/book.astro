---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import EmptyState from '../components/EmptyState.astro';
import BookCard from '../components/BookCard.astro';
import { getCollection } from 'astro:content';
import type { Book } from '../lib/types/book';

const pageTitle = 'Book';
const pageDescription = 'これまで読んだ技術書の記録';

const bookEntries = await getCollection('books');

// Sort by read_date descending, nulls last
const books: Book[] = bookEntries
  .map((entry: any) => entry.data)
  .sort((a: Book, b: Book) => {
    if (!a.read_date && !b.read_date) return 0;
    if (!a.read_date) return 1;
    if (!b.read_date) return -1;
    return new Date(b.read_date).getTime() - new Date(a.read_date).getTime();
  });
---

<BaseLayout pageTitle={pageTitle}>
  <Hero
    title={pageTitle}
    description={pageDescription}
    variant="book"
  />

  <Section maxWidth="1200px">
    {books.length === 0 ? (
      <EmptyState message="まだ読書記録が登録されていません" />
    ) : (
      <div class="books-grid">
        {books.map((book) => (
          <BookCard book={book} />
        ))}
      </div>
    )}
  </Section>
</BaseLayout>

<style>
  .books-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .books-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>
