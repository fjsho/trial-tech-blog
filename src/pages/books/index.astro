---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Section from '../../components/Section.astro';
import EmptyState from '../../components/EmptyState.astro';
import BookCard from '../../components/BookCard.astro';
import { supabase, type Book } from '../../lib/supabase';

const { data: booksData, error } = await supabase
  .from('books')
  .select('*')
  .order('read_date', { ascending: false, nullsFirst: false });

const books: Book[] = booksData || [];
---

<BaseLayout title="Books - Tech Blog" description="読んだ技術書の記録とレビュー">
  <Hero
    title="Books"
    description="読んだ技術書の記録とレビュー"
    variant="books"
  />

  <Section maxWidth="1200px">
    {books.length === 0 ? (
      <EmptyState message="まだ読書記録が登録されていません" />
    ) : (
      <div class="books-grid">
        {books.map((book) => (
          <BookCard book={book} />
        ))}
      </div>
    )}
  </Section>
</BaseLayout>

<style>
  .books-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .books-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>
